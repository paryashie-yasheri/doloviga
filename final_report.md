1. Титульный лист

Университет: ИТМО
Факультет: ПИиКТ
Дисциплина: Встроенные системы

Отчет по проекту: "Doloviga"
Тема: Настольные часы с визуализацией окружающих звуков

Над проектом работали: Жук И. А., Тынкевич В. Н., Григорьев Д. В.

Год: 2026

2. Описание проекта
   - Актуальность и проблематика
     Компактные настольные устройства часто выполняют только функцию часов и не дают наглядной информации о звуковой среде. Проект решает задачу объединения часов, визуализатора звука и вспомогательных датчиков в одном устройстве, что делает его полезным и эффектным для использования в помещении.
   - Краткое описание проекта
     Doloviga — настольные часы на базе ESP32 с микрофоном I2S и дисплеем SPI. Устройство отображает текущее время, температуру/влажность, а также визуализирует уровень громкости и спектр звука с помощью FFT и анимации полос. Время синхронизируется по Bluetooth через мобильный клиент.
   - Цель проекта
     Разработать настольные часы с функцией визуализации окружающих звуков в реальном времени.
   - Задачи для достижения поставленной цели
     - Выбрать аппаратную платформу (ESP32, микрофон I2S, дисплей SPI, датчик DHT11).
     - Реализовать сбор аудиоданных, анализ громкости и спектра.
     - Создать интерфейс отображения на дисплее (LVGL).
     - Реализовать синхронизацию времени и настройку устройства по Bluetooth.
     - Подготовить мобильное приложение для управления устройством.
     - Подготовить итоговую документацию.

3. Техническое задание
  - Команда исполнителей
    - Разработчик аппаратной части.
    - Разработчик встроенного ПО.
    - Разработчик мобильного клиента.
  - Технические требования
    - Отображение текущего времени (часы, минуты).
    - Визуализация громкости/спектра окружающего звука на дисплее.
    - Возможность смены режимов отображения (DEFAULT/DETAILED/MINIMAL).
    - Настольное питание от USB-адаптера 5В.
    - Непрерывная работа не менее 12 часов от сети.
    - Восстановление работы после сбоя питания.
    - Использование в помещении: +10…+35 °C, влажность до 70 % без конденсата.
  - Требования к документации
    - Схема электрическая принципиальная.
    - Руководство пользователя (режимы работы, подключение).
    - Описание исходного кода и инструкции по прошивке.
  - Технико-экономические показатели
    - Стоимость прототипа: 2000–3000 руб.
    - Преимущества: компактность, простота сборки, визуализация звука в реальном времени.
  - Cтадии и этапы разработки
    1) Анализ требований и составление ТЗ.
    2) Эскизное проектирование и разработка схемы.
    3) Разработка программного обеспечения.
    4) Изготовление и сборка прототипа.
    5) Тестирование и доработка.
    6) Подготовка документации.
  - Порядок контроля и приемки
    - Проверка корректного отображения времени.
    - Проверка работы микрофона и визуализации при разных уровнях звука.
    - Проверка надежности работы от сети.

4. Описание архитектуры проекта
  - Диаграмма архитектуры устройства
    [Микрофон INMP441] --I2S--> [ESP32] --SPI--> [TFT 128x160 + LVGL UI]
                               |             \
                               |              -> [Отображение: время, температура, влажность, спектр]
                               |
                               +--GPIO--> [DHT11]
                               |
                               +--Bluetooth SPP<-> [Android-клиент DolovigaBtClient]
                                                (SYNC/TIME?/UI/NAME)

  - Краткое текстовое описание архитектуры проекта
    В основе устройства — ESP32, собирающий аудиоданные с I2S-микрофона INMP441. Поток оцифрованных данных обрабатывается в модуле анализа: вычисляется RMS-громкость, выполняется FFT с логарифмическим разбиением на 10 полос, применяется сглаживание по пику. Результаты визуализируются на TFT-дисплее 128x160 через LVGL. Дополнительно устройство отображает температуру и влажность с датчика DHT11. Для синхронизации времени и настройки режимов интерфейса используется Bluetooth Serial (SPP), с которым работает Android-клиент. Временная зона задается на устройстве, а приложение синхронизирует epoch-время.

5. Краткое руководство по эксплуатации проекта
  1) Подключить устройство к питанию 5В (USB).
  2) Дождаться загрузки интерфейса на дисплее.
  3) Запустить приложение DolovigaBtClient и разрешить Bluetooth.
  4) В разделе "Подключения" выбрать устройство ESP32 и выполнить соединение.
  5) В разделе "Время" нажать "Синхронизировать".
  6) При необходимости выбрать режим интерфейса или задать имя устройства.

6. Описание хода выполнения работы
  - Этап 1: Анализ требований и ТЗ
    Сформированы цели, функции устройства и ограничения (питание, условия эксплуатации). Определен базовый состав компонентов: ESP32, I2S-микрофон, дисплей, датчик температуры/влажности.
  - Этап 2: Проектирование и выбор компонентов
    Выбран микрофон INMP441 и SPI-дисплей 128x160, определены интерфейсы (I2S, SPI, GPIO). Разработана концепция интерфейса на LVGL.
  - Этап 3: Разработка ПО
    Встроенное ПО: реализован сбор аудиоданных по I2S, расчет RMS и FFT, динамическая нормализация и сглаживание пиков, отображение времени/температуры/влажности. Реализован Bluetooth-протокол команд (TIME?, SYNC, UI, NAME).
    Мобильный клиент: реализованы поиск устройств, подключение по SPP, синхронизация времени, выбор режима интерфейса и смена имени устройства.
  - Этап 4: Интеграция и отладка
    Настроены частоты выборки (44.1 кГц), размер буфера (256 сэмплов), интервалы обновления UI. Отлажено взаимодействие модулей в главном цикле (audio/UI/датчики/Bluetooth).
  - Проблемы и решения
    - Нестабильный уровень громкости: введена нормализация по среднему RMS и сглаживание падения пиков.
    - Разные уровни шумов: применено ограничение минимального порога RMS и динамическая калибровка.
    - Надежность Bluetooth-команд: добавлены ответы OK/ERR и обработка потери соединения в клиенте.
  - Вклад участников
    - Аппаратная часть (пайка, разработка схемы) - Валерий, Давид.
    - Разработка ПО для esp32 - Вся команда
    - Мобильный клиент - Иван

7. Описание результатов проведенной работы
  - Реализовано устройство на ESP32 с визуализацией звука, отображением времени и датчиков.
  - Разработан модуль FFT с 10 логарифмическими полосами и сглаживанием пиков.
  - Реализована синхронизация времени и управление параметрами через Bluetooth.
  - Создан Android-клиент DolovigaBtClient для подключения и управления.
  - Подготовлена архитектурная и техническая документация.
  - Перспективы развития:
    - Переход на BLE и расширенный протокол настроек.
    - Добавление новых сенсоров (CO2, освещенность).
    - Расширение UI (несколько экранов, пользовательские профили).
    - Оптимизация энергопотребления и добавление автономного питания.

8. Используемые источники
  1) ГОСТ 19.201-78 «Техническое задание. Требования к содержанию и оформлению».
  2) Документация ESP32 и Arduino Core для ESP32.
  3) Документация по микрофону INMP441 (I2S).
  4) Документация DHT11.
  5) Документация LVGL.
  6) Документация ArduinoFFT.
